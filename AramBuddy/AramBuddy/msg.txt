Reworked big parts of the code !